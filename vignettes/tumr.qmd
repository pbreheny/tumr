---
title: "Getting started with the tumr package"
vignette: >
  %\VignetteIndexEntry{Quarto HTML Vignettes}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

# Melanoma

```{r}
library(tumr)
data("melanoma2")
```

#### Code for plot_mean()
```{r}
#| code-fold: true
plot_mean <- function(data, group, time, measure, id, stat = median, remove_na = FALSE){
  data_summary <- data |>
    dplyr::group_by({{group}}, {{time}}) |>
    dplyr::summarise(measure = stat({{measure}}, na.rm = remove_na), .groups = "drop_last") |>
    dplyr::ungroup()

  if (remove_na == TRUE) {
    data_full <- data |>
      na.omit(data)
  } else {
    data_full <- data
  }

  ggplot2::ggplot() +
    ggplot2::geom_line(data = data_full,
                       ggplot2::aes(x = {{time}},
                                    y = {{measure}},
                                    group = {{id}},
                                    color = {{group}}),
                       alpha = 0.5)  +
    ggplot2::geom_line(data = data_summary,
                       ggplot2::aes(x = {{time}},
                                    y = measure,
                                    color = {{group}}),
                       linewidth = 1.2)

}
```

## Plotting the Mean vs the Median

```{r}
#| layout-ncol: 2
#| fig-width: 4
#| fig-height: 3.5
mel2 <- tumr(melanoma2, ID, Day, Volume, Treatment)
plot_mean(melanoma2, Treatment, Day, Volume, ID, stat = mean)
plot_median(mel2)
```

## Response feature analysis

```{r}
(rfeat_mel2 <- rfeat(mel2, comparison = "both"))
plot(rfeat_mel2)
```

## Linear mixed model

```{r}
(lmm_mel2 <- lmm(mel2))
```

## Plot of linear mixed model

```{r}
plot(lmm_mel2)
```



# Other data sets

## Breast cancer

```{r}
breast_meta <- tumr(breast, ID, Week, Volume, Treatment)

plot_median(breast_meta)
breast_rfeat <- rfeat(breast_meta, comparison = "t.test")
plot(breast_rfeat)
breast_lmm <- lmm(breast_meta)
summary(breast_lmm)
```

## Another melanoma

```{r}
mel1 <- tumr(melanoma1, ID, Day, Volume, Treatment)

plot_median(mel1)
(mel1_rfeat <- rfeat(mel1, comparison = "both"))
plot(mel1_rfeat)

(mel1_lmm <- lmm(mel1))

summary(mel1_lmm)
```

## Prostate cancer

```{r}
pros_meta <- tumr(prostate, ID, Age, BLI, Genotype)

plot_median(pros_meta)
(pros_rfeat <- rfeat(pros_meta, comparison = "both"))
plot(pros_rfeat)
(pros_lmm <- lmm(pros_meta))
summary(pros_lmm)
```

